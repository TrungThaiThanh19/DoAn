@model DoAn.Models.HoaDon
@{
    ViewData["Title"] = "Đặt hàng thành công";
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    .shp-header {
        background: linear-gradient(180deg,#16a34a,#22c55e);
        color: #fff
    }

    .shp-brand {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #fff;
        text-decoration: none;
        font-weight: 800;
        font-size: 1.5rem
    }

        .shp-brand img {
            height: 36px
        }

    .wrap {
        max-width: 1000px;
        margin: 24px auto
    }

    .sum {
        font-weight: 800;
        color: #ef4444
    }

    .order-chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        background: #ecfdf5;
        color: #065f46;
        font-weight: 700
    }

    .info-card {
        border: 1px solid #e5e7eb;
        border-radius: 14px;
        overflow: hidden
    }

        .info-card .card-header {
            background: #fff;
            font-weight: 800
        }

    .meta {
        color: #6b7280;
    }

    .divider-dashed {
        border-top: 1px dashed #e5e7eb;
    }

    .btn-brand {
        background: linear-gradient(135deg,#16a34a,#22c55e);
        color: #fff;
        border: 0;
        font-weight: 800
    }
</style>

<header class="shp-header">
    <div class="container py-3">
        <div class="d-flex align-items-center gap-3">
            <a href="~/" class="shp-brand"><img src="~/images/logo.png" /><span>ShopPerfume</span></a>
            <span class="ms-auto fw-bold"><i class="fa-solid fa-circle-check me-2"></i>Đặt hàng thành công</span>
        </div>
    </div>
</header>

<div class="wrap">
    <div class="alert alert-success d-flex align-items-center" role="alert">
        <i class="fa-solid fa-badge-check me-2"></i>
        <div>
            Cảm ơn bạn! Đơn hàng <b>@Model.Ma_HoaDon</b> đã được tạo.
            <span class="ms-2 order-chip"><i class="fa-solid fa-check"></i> Đặt hàng thành công</span>
        </div>
    </div>

    <!-- Tóm tắt -->
    <div class="row g-3 mb-3">
        <div class="col-lg-6">
            <div class="card info-card">
                <div class="card-header"><i class="fa-solid fa-receipt me-2"></i>Thông tin đơn</div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6 meta">Mã đơn</div>
                        <div class="col-6 text-end"><b>@Model.Ma_HoaDon</b></div>
                        <div class="col-6 meta">Ngày tạo</div>
                        <div class="col-6 text-end">@Model.NgayTao.ToString("dd/MM/yyyy HH:mm")</div>
                        <div class="col-6 meta">Thanh toán</div>
                        <div class="col-6 text-end">@Model.HinhThucThanhToan</div>
                        <div class="col-6 meta">Tổng thanh toán</div>
                        <div class="col-6 text-end sum">@Model.TongTienSauGiam.ToString("n0") đ</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Người nhận & địa chỉ -->
        <div class="col-lg-6">
            <div class="card info-card">
                <div class="card-header"><i class="fa-solid fa-location-dot me-2"></i>Người nhận & địa chỉ</div>
                <div class="card-body">
                    <div class="mb-1"><span class="meta">Người nhận:</span> <b>@(string.IsNullOrWhiteSpace(Model.HoTen) ? "—" : Model.HoTen)</b></div>
                    <div class="mb-1"><span class="meta">Số điện thoại:</span> <b>@(string.IsNullOrWhiteSpace(Model.Sdt_NguoiNhan) ? "—" : Model.Sdt_NguoiNhan)</b></div>
                    <div class="mb-0"><span class="meta">Địa chỉ:</span> @Model.DiaChi</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chi tiết sản phẩm -->
    <div class="card info-card">
        <div class="card-header"><i class="fa-solid fa-box-open me-2"></i>Chi tiết sản phẩm</div>
        <div class="table-responsive">
            <table class="table align-middle mb-0">
                <thead>
                    <tr>
                        <th style="min-width:320px">Sản phẩm</th>
                        <th class="text-end">Đơn giá</th>
                        <th class="text-center">SL</th>
                        <th class="text-end">Thành tiền</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var d in Model.HoaDonChiTiets)
                    {
                        var ten = d.SanPhamChiTiet?.SanPham?.Ten_SanPham ?? "Sản phẩm";
                        var variant = d.SanPhamChiTiet?.TheTich != null
                        ? d.SanPhamChiTiet.TheTich.DonVi
                        : null;  // nếu có thuộc tính khác như DungTich thì thay vào đây
                        <tr>
                            <td>
                                <div class="fw-semibold">@ten</div>
                                @if (!string.IsNullOrWhiteSpace(variant))
                                {
                                    <div class="meta">Biến thể: @variant</div>
                                }
                            </td>
                            <td class="text-end">@d.DonGia.ToString("n0") đ</td>
                            <td class="text-center">@d.SoLuong</td>
                            <td class="text-end">@((d.SoLuong * d.DonGia).ToString("n0")) đ</td>
                        </tr>
                    }
                </tbody>
                <tfoot>
                    <tr class="divider-dashed"><td colspan="4"></td></tr>
                    <tr>
                        <th colspan="3" class="text-end">Tạm tính</th>
                        <th class="text-end">@Model.TongTienTruocGiam.ToString("n0") đ</th>
                    </tr>
                    <tr>
                        <th colspan="3" class="text-end">Phí vận chuyển</th>
                        <th class="text-end">@((Model.PhuThu ?? 0).ToString("n0")) đ</th>
                    </tr>
                    <tr>
                        <th colspan="3" class="text-end">Tổng thanh toán</th>
                        <th class="text-end sum">@Model.TongTienSauGiam.ToString("n0") đ</th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <div class="mt-3 d-flex gap-2">
        <a class="btn btn-outline-primary" href="@Url.Action("Index","Shop")"><i class="fa-solid fa-arrow-left-long me-1"></i>Tiếp tục mua sắm</a>
        <button class="btn btn-brand" onclick="window.print()"><i class="fa-solid fa-print me-2"></i>In hoá đơn</button>
    </div>
</div>