@using Microsoft.AspNetCore.Http
<style>
    .nav-link {
        font-size: 14px !important;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        padding: 10px 15px;
    }

    .nav-link-toggle {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

        .nav-link-toggle::after {
            content: "\f107"; /* FontAwesome ▼ */
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
            font-size: 12px;
        }

    .submenu a {
        padding-left: 30px !important;
        font-size: 13px !important;
    }
</style>

<div class="sidebar pe-4 pb-3 bg-light" style="min-height: 100vh;">
    <nav class="navbar navbar-light">
        <a href="/Admin/Index" class="navbar-brand mx-4 mb-3">
            <img src="logo.png" alt="Logo" style="height: 40px;">
        </a>

        <div class="d-flex align-items-center ms-4 mb-4">
            <div class="position-relative">
                <img class="rounded-circle" src="~/img/user.jpg" alt="User" style="width: 40px; height: 40px;">
                <div class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1"></div>
            </div>
            <div class="ms-3">
                @{
                    // Ưu tiên lấy từ Claims (User.Identity) -> fallback Session
                    var displayName = (User?.Identity?.IsAuthenticated ?? false)
                    ? (User.Identity?.Name ?? Context.Session.GetString("Username") ?? "Người dùng")
                    : (Context.Session.GetString("Username") ?? "Người dùng");

                    var displayRole = User.IsInRole("admin") ? "admin"
                    : User.IsInRole("nhanvien") ? "nhanvien"
                    : (Context.Session.GetString("RoleName") ?? "Unknown");
                }
                <h6 class="mb-0">@displayName</h6>
                <span>@displayRole</span>
            </div>
        </div>

        <div class="navbar-nav w-100">
            @* ADMIN: thấy full menu *@
            @if (User.IsInRole("admin"))
            {
                <a href="/ThongKe/Index" class="nav-item nav-link">
                    <i class="fa fa-chart-bar me-2"></i>Thống kê
                </a>

                <a href="/HoaDon/Index" class="nav-item nav-link">
                    <i class="fa fa-shopping-cart me-2"></i>Quản lý hóa đơn
                </a>

                <a href="/POS/Index" class="nav-item nav-link">
                    <i class="fa fa-store me-2"></i>Bán hàng tại quầy
                </a>

                <a class="nav-item nav-link nav-link-toggle" data-bs-toggle="collapse" href="#collapseTaiKhoan" role="button" aria-expanded="false">
                    <span><i class="fa fa-users me-2"></i> Quản lý tài khoản</span>
                </a>
                <div class="collapse submenu" id="collapseTaiKhoan">
                    <a href="/NhanVien/Index" class="nav-link">Nhân viên</a>
                    <a href="/KhachHang/Index" class="nav-link">Khách hàng</a>
                </div>

                <a class="nav-item nav-link nav-link-toggle" data-bs-toggle="collapse" href="#collapseSanPham" role="button" aria-expanded="false">
                    <span><i class="fa fa-box me-2"></i> Quản lý sản phẩm</span>
                </a>
                <div class="collapse submenu" id="collapseSanPham">
                    <a href="/Products/Index" class="nav-link">Sản phẩm</a>
                    <a href="/Brands/Index" class="nav-link">Thương hiệu</a>
                    <a href="/Volumes/Index" class="nav-link">Dung tích</a>
                    <a href="/Genders/Index" class="nav-link">Giới tính</a>
                    <a href="/Countries/Index" class="nav-link">Quốc Gia</a>
                </div>

                <a class="nav-item nav-link nav-link-toggle" data-bs-toggle="collapse" href="#collapseKhuyenMai" role="button" aria-expanded="false">
                    <span><i class="fa fa-bullhorn me-2"></i> Khuyến mãi</span>
                </a>
                <div class="collapse submenu" id="collapseKhuyenMai">
                    <a href="/KhuyenMai/Index" class="nav-link">Quản lý khuyến mãi</a>
                    <a href="/Voucher/Index" class="nav-link">Quản lý voucher</a>
                </div>
            }
            @* NHÂN VIÊN: chỉ Hóa đơn + POS *@
            else if (User.IsInRole("nhanvien"))
            {
                <a href="/HoaDon/Index" class="nav-item nav-link">
                    <i class="fa fa-shopping-cart me-2"></i>Quản lý hóa đơn
                </a>
                <a href="/POS/Index" class="nav-item nav-link">
                    <i class="fa fa-store me-2"></i>Bán hàng tại quầy
                </a>
            }
            @* Vai trò khác (khách hàng...) không hiện menu admin *@
        </div>
    </nav>
</div>
